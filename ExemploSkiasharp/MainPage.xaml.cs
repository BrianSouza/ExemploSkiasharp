using SkiaSharp;
using SkiaSharp.Views.Forms;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Xamarin.Forms;

namespace ExemploSkiasharp
{
    // Learn more about making custom code visible in the Xamarin.Forms previewer
    // by visiting https://aka.ms/xamarinforms-previewer
    [DesignTimeVisible(false)]
    public partial class MainPage : ContentPage
    {
        public MainPage()
        {
            InitializeComponent();
            skcv.PaintSurface += OnCanvasViewPaintSurface;
        }

        public SKPath path = SKPath.ParseSvgPathData
           (@"M 101.5002059936523 267.5002136230469 C 88.77776336669922 267.5002136230469 76.37395477294922 264.4128112792969 64.63336181640625 258.32373046875 C 58.97598266601563 255.3896331787109 53.48276519775391 251.7479705810547 48.30629730224609 247.4999084472656 C 43.20171737670898 243.3108520507813 38.34761047363281 238.4853057861328 33.87738418579102 233.1558990478516 C 25.12598037719727 210.9773864746094 20.49979591369629 185.1627960205078 20.49979591369629 158.4999084472656 C 20.49979591369629 149.2589111328125 21.05904579162598 140.0239105224609 22.16201400756836 131.0514373779297 C 23.23679542541504 122.308219909668 24.84045219421387 113.7084732055664 26.92839050292969 105.491096496582 C 28.97792053222656 97.42494201660156 31.5144214630127 89.64569091796875 34.46745300292969 82.36946868896484 C 37.39117050170898 75.16547393798828 40.74832916259766 68.39200592041016 44.44570159912109 62.23722076416016 C 48.14045333862305 56.08678436279297 52.20501327514648 50.50403213500977 56.52651596069336 45.64403533935547 C 60.88467025756836 40.74281311035156 65.54216766357422 36.53428268432617 70.36957550048828 33.13534545898438 C 75.279296875 29.67847061157227 80.41539001464844 27.0241584777832 85.63513946533203 25.24609565734863 C 90.98526763916016 23.42365837097168 96.49111175537109 22.49959564208984 101.9997024536133 22.49959564208984 C 107.5084228515625 22.49959564208984 113.0143280029297 23.42365837097168 118.3645172119141 25.24609565734863 C 123.584358215332 27.0241584777832 128.7204895019531 29.67847061157227 133.6302032470703 33.13534545898438 C 138.4576416015625 36.53425216674805 143.1151428222656 40.74278259277344 147.4732971191406 45.64403533935547 C 151.7947692871094 50.50403213500977 155.8593292236328 56.08678436279297 159.5540466308594 62.23722076416016 C 163.2513885498047 68.39200592041016 166.6085205078125 75.16547393798828 169.5321960449219 82.36946868896484 C 172.4851684570313 89.64566040039063 175.0216369628906 97.42491149902344 177.0711364746094 105.491096496582 C 179.1590423583984 113.7084732055664 180.7626647949219 122.308219909668 181.8374176025391 131.0514373779297 C 182.9403533935547 140.0238800048828 183.4996032714844 149.2588806152344 183.4996032714844 158.4999084472656 C 183.4996032714844 171.5400695800781 182.3947906494141 184.4354095458984 180.2158203125 196.8277282714844 C 178.1103820800781 208.8019409179688 175.0150451660156 220.2452850341797 171.0158538818359 230.8404541015625 C 166.4947509765625 236.5118408203125 161.5546112060547 241.654541015625 156.3321075439453 246.1260986328125 C 151.0401458740234 250.6571197509766 145.4043884277344 254.5448760986328 139.5813903808594 257.6813354492188 C 133.6540832519531 260.8739929199219 127.4640121459961 263.32470703125 121.18310546875 264.9653625488281 C 114.7439193725586 266.6473693847656 108.1216430664063 267.5002136230469 101.5002059936523 267.5002136230469 Z");

        void OnCanvasViewPaintSurface(object sender, SKPaintSurfaceEventArgs args)
        {

            SKImageInfo info = args.Info;
            SKSurface surface = args.Surface;
            SKCanvas canvas = surface.Canvas;

            canvas.Clear();

            // Set transform to center and enlarge clip path to window height
            SKRect bounds;
            path.GetTightBounds(out bounds);

            canvas.Translate(info.Width / 2, info.Height / 2);
            canvas.Scale((0.5f * info.Height / bounds.Height) *-1);
            canvas.Translate(-bounds.MidX, -bounds.MidY);

            // Set the clip path
            canvas.ClipPath(path,SKClipOperation.Difference);

            // Reset transforms
            canvas.ResetMatrix();
            using (SKPaint paint2 = new SKPaint())
            {
                paint2.Style = SKPaintStyle.Fill;
                paint2.Color = SKColors.Green.WithAlpha(0x50);
                canvas.DrawPaint(paint2);

            }
        }
    }
}
